generator client {
  provider = "prisma-client-js"
  // output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model clientes {
  id             Int       @id @default(autoincrement())
  nombre         String    @db.VarChar(100)
  telefono       String    @db.VarChar(20)
  direccion      String
  fecha_registro DateTime? @default(now()) @db.Timestamp(6)
  empresa_id     Int
  empresas       empresas  @relation(fields: [empresa_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_empresa_cliente")
  pedidos        pedidos[]

  @@unique([telefono, empresa_id], map: "unique_cliente_telefono_empresa")
}

model empresas {
  id                Int                 @id @default(autoincrement())
  nombre            String              @db.VarChar(100)
  telefono_contacto String?             @db.VarChar(20)
  created_at        DateTime?           @default(now()) @db.Timestamp(6)
  clientes          clientes[]
  sesiones_whatsapp sesiones_whatsapp[]
  usuarios_admin    usuarios_admin[]
}

model pedidos {
  id            Int       @id @default(autoincrement())
  cliente_id    Int
  cantidad      Int
  fecha_pedido  DateTime? @default(now()) @db.Timestamp(6)
  estado        String?   @default("pendiente") @db.VarChar(50)
  observaciones String?
  clientes      clientes  @relation(fields: [cliente_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cliente")
}

model sesiones_whatsapp {
  id                 Int       @id @default(autoincrement())
  numero             String    @unique @db.VarChar(20)
  nombre_dispositivo String?   @db.VarChar(100)
  empresa_id         Int
  created_at         DateTime? @default(now()) @db.Timestamp(6)
  empresas           empresas  @relation(fields: [empresa_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_empresa_sesion")
}

model usuarios_admin {
  id         Int      @id @default(autoincrement())
  usuario    String   @unique @db.VarChar(50)
  contrase_a String   @map("contrase√±a") @db.VarChar(255)
  rol        String?  @default("soporte") @db.VarChar(20)
  empresa_id Int
  empresas   empresas @relation(fields: [empresa_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_empresa_usuario")
}
